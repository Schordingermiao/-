today="2023-10-11"
import sys
sys.path.append("./backtest")
sys.path.append("./generate_signal")
sys.path.append("./framework")


from easy_backtest import strategy_test
#from backtest_thread import strategy_test


import pandas as pd
Close111=pd.read_csv("股票数据/"+today+"/AStockclose1m_2023A.csv",index_col=0)
Open111=pd.read_csv("股票数据/"+today+"/AStockopen1m_2023A.csv",index_col=0)
High111=pd.read_csv("股票数据/"+today+"/AStockhigh1m_2023A.csv",index_col=0)
Low111=pd.read_csv("股票数据/"+today+"/AStocklow1m_2023A.csv",index_col=0)


Close_day111=pd.read_csv("股票数据/"+today+"/AStockclose1d_2023A.csv",index_col=0)
Open_day111=pd.read_csv("股票数据/"+today+"/AStockopen1d_2023A.csv",index_col=0)
High_day111=pd.read_csv("股票数据/"+today+"/AStockhigh1d_2023A.csv",index_col=0)
Low_day111=pd.read_csv("股票数据/"+today+"/AStocklow1d_2023A.csv",index_col=0)

Volume111=pd.read_csv("股票数据/"+today+"/AStockvolume1m_2023A.csv",index_col=0)
STlist=['000004.SZ', '000005.SZ', '000007.SZ', '000010.SZ', '000017.SZ', '000023.SZ', '000038.SZ', '000046.SZ', '000150.SZ', \
        '000408.SZ', '000409.SZ', '000410.SZ', '000416.SZ', '000422.SZ', '000502.SZ', '000504.SZ', '000509.SZ', '000516.SZ', \
        '000523.SZ', '000525.SZ', '000535.SZ', '000536.SZ', '000540.SZ', '000546.SZ', '000564.SZ', '000571.SZ', '000572.SZ', \
        '000583.SZ', '000584.SZ', '000585.SZ', '000587.SZ', '000595.SZ', '000606.SZ', '000609.SZ', '000611.SZ', '000613.SZ', \
        '000615.SZ', '000616.SZ', '000620.SZ', '000637.SZ', '000638.SZ', '000662.SZ', '000663.SZ', '000667.SZ', '000669.SZ', \
        '000670.SZ', '000671.SZ', '000673.SZ', '000679.SZ', '000687.SZ', '000692.SZ', '000697.SZ', '000699.SZ', '000707.SZ', \
        '000711.SZ', '000727.SZ', '000732.SZ', '000737.SZ', '000752.SZ', '000760.SZ', '000765.SZ', '000769.SZ', '000780.SZ', \
        '000787.SZ', '000792.SZ', '000796.SZ', '000802.SZ', '000803.SZ', '000805.SZ', '000806.SZ', '000809.SZ', '000816.SZ', \
        '000820.SZ', '000827.SZ', '000832.SZ', '000835.SZ', '000837.SZ', '000839.SZ', '000868.SZ', '000889.SZ', '000890.SZ', \
        '000897.SZ', '000909.SZ', '000911.SZ', '000918.SZ', '000927.SZ', '000939.SZ', '000953.SZ', '000971.SZ', '000972.SZ', \
        '000976.SZ', '000980.SZ', '000981.SZ', '000982.SZ', '000995.SZ', '000996.SZ', '002005.SZ', '002021.SZ', '002022.SZ', \
        '002024.SZ', '002052.SZ', '002058.SZ', '002069.SZ', '002071.SZ', '002072.SZ', '002076.SZ', '002077.SZ', '002086.SZ', \
        '002087.SZ', '002089.SZ', '002102.SZ', '002113.SZ', '002118.SZ', '002121.SZ', '002122.SZ', '002147.SZ', '002157.SZ', \
        '002168.SZ', '002175.SZ', '002176.SZ', '002177.SZ', '002188.SZ', '002190.SZ', '002192.SZ', '002200.SZ', '002207.SZ', \
        '002210.SZ', '002211.SZ', '002219.SZ', '002220.SZ', '002247.SZ', '002255.SZ', '002256.SZ', '002259.SZ', '002260.SZ', \
        '002263.SZ', '002280.SZ', '002289.SZ', '002290.SZ', '002306.SZ', '002309.SZ', '002313.SZ', '002316.SZ', '002319.SZ', \
        '002321.SZ', '002323.SZ', '002333.SZ', '002336.SZ', '002354.SZ', '002356.SZ', '002358.SZ', '002359.SZ', '002366.SZ', \
        '002411.SZ', '002417.SZ', '002418.SZ', '002420.SZ', '002426.SZ', '002427.SZ', '002433.SZ', '002445.SZ', '002447.SZ', \
        '002450.SZ', '002464.SZ', '002470.SZ', '002473.SZ', '002482.SZ', '002485.SZ', '002496.SZ', '002499.SZ', '002501.SZ', \
        '002502.SZ', '002503.SZ', '002504.SZ', '002513.SZ', '002529.SZ', '002535.SZ', '002564.SZ', '002569.SZ', '002575.SZ', \
        '002586.SZ', '002592.SZ', '002604.SZ', '002618.SZ', '002619.SZ', '002629.SZ', '002638.SZ', '002640.SZ', '002642.SZ', \
        '002650.SZ', '002656.SZ', '002668.SZ', '002681.SZ', '002684.SZ', '002692.SZ', '002699.SZ', '002700.SZ', '002711.SZ', \
        '002716.SZ', '002719.SZ', '002721.SZ', '002740.SZ', '002742.SZ', '002751.SZ', '002766.SZ', '002770.SZ', '002776.SZ', \
        '002781.SZ', '002800.SZ', '002808.SZ', '002816.SZ', '002872.SZ', '002951.SZ', '300010.SZ', '300023.SZ', '300029.SZ', \
        '300038.SZ', '300044.SZ', '300051.SZ', '300064.SZ', '300071.SZ', '300089.SZ', '300108.SZ', '300159.SZ', '300167.SZ', \
        '300178.SZ', '300201.SZ', '300202.SZ', '300209.SZ', '300220.SZ', '300256.SZ', '300268.SZ', '300269.SZ', '300273.SZ', \
        '300278.SZ', '300282.SZ', '300297.SZ', '300301.SZ', '300309.SZ', '300312.SZ', '300313.SZ', '300325.SZ', '300330.SZ', \
        '300336.SZ', '300338.SZ', '300356.SZ', '300367.SZ', '300370.SZ', '300392.SZ', '300427.SZ', '300446.SZ', '300495.SZ', \
        '300526.SZ', '300530.SZ', '300555.SZ', '300742.SZ', '300795.SZ', '300799.SZ', '300859.SZ', '600003.SH', '600065.SH', \
        '600069.SH', '600070.SH', '600077.SH', '600078.SH', '600080.SH', '600083.SH', '600084.SH', '600086.SH', '600090.SH', \
        '600091.SH', '600092.SH', '600093.SH', '600112.SH', '600117.SH', '600119.SH', '600122.SH', '600136.SH', '600139.SH', \
        '600145.SH', '600146.SH', '600149.SH', '600157.SH', '600175.SH', '600179.SH', '600181.SH', '600182.SH', '600191.SH', \
        '600193.SH', '600198.SH', '600209.SH', '600212.SH', '600215.SH', '600221.SH', '600225.SH', '600226.SH', '600228.SH', \
        '600234.SH', '600238.SH', '600239.SH', '600241.SH', '600242.SH', '600243.SH', '600247.SH', '600255.SH', '600260.SH', \
        '600265.SH', '600275.SH', '600280.SH', '600286.SH', '600289.SH', '600290.SH', '600291.SH', '600300.SH', '600301.SH', \
        '600303.SH', '600306.SH', '600311.SH', '600319.SH', '600354.SH', '600358.SH', '600365.SH', '600382.SH', '600385.SH', \
        '600387.SH', '600388.SH', '600393.SH', '600396.SH', '600399.SH', '600403.SH', '600408.SH', '600416.SH', '600421.SH', \
        '600423.SH', '600462.SH', '600466.SH', '600470.SH', '600485.SH', '600506.SH', '600515.SH', '600518.SH', '600530.SH', \
        '600532.SH', '600539.SH', '600543.SH', '600555.SH', '600568.SH', '600589.SH', '600591.SH', '600593.SH', '600595.SH', \
        '600599.SH', '600601.SH', '600608.SH', '600610.SH', '600614.SH', '600615.SH', '600634.SH', '600647.SH', '600651.SH', \
        '600652.SH', '600654.SH', '600659.SH', '600666.SH', '600671.SH', '600672.SH', '600677.SH', '600680.SH', '600687.SH', \
        '600695.SH', '600696.SH', '600698.SH', '600700.SH', '600701.SH', '600702.SH', '600719.SH', '600721.SH', '600725.SH', \
        '600726.SH', '600734.SH', '600752.SH', '600759.SH', '600762.SH', '600766.SH', '600767.SH', '600772.SH', '600781.SH', \
        '600788.SH', '600799.SH', '600804.SH', '600807.SH', '600815.SH', '600816.SH', '600817.SH', '600821.SH', '600823.SH', \
        '600836.SH', '600852.SH', '600856.SH', '600860.SH', '600870.SH', '600877.SH', '600890.SH', '600891.SH', '600892.SH', \
        '600896.SH', '600898.SH', '600899.SH', '600978.SH', '601020.SH', '601113.SH', '601258.SH', '601268.SH', '601399.SH', \
        '601777.SH', '603001.SH', '603007.SH', '603030.SH', '603032.SH', '603039.SH', '603117.SH', '603133.SH', '603157.SH', \
        '603188.SH', '603322.SH', '603389.SH', '603555.SH', '603557.SH', '603559.SH', '603603.SH', '603729.SH', '603779.SH', \
        '603863.SH', '603880.SH', '603996.SH', '688086.SH', '688272.SH', '688309.SH', '688500.SH', '688555.SH']


alist=[]
for tk1 in Close111.columns:
    if tk1 not in STlist:
        alist.append(tk1)
len(alist)


Close111=Close111[alist]
Open111=Open111[alist]
High111=High111[alist]
Low111=Low111[alist]

Close_day111=Close_day111[alist]
Open_day111=Open_day111[alist]
High_day111=High_day111[alist]
Low_day111=Low_day111[alist]






df,result=strategy_test(0.9,0.025,Open111,High111,Low111,Close111,Volume111)

import matplotlib.pyplot as plt

fig=plt.figure(figsize=(20,5),dpi=300)
plt.plot(df)
plt.yticks([1,1.01,1.02,1.03,1.04,1.05,1.06,1.07,1.08,1.09,1.1,1.11,1.12,1.13,1.14,1.15,1.16,1.17,1.18,1.19,1.2])